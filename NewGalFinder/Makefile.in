#--------------------------------------------------
#--- Makefile for NewGalFinder
#--- Generated by ../configure
#--------------------------------------------------

#--- Objects to build
OBJS		= gfind.o Memory2.o force_spline.mod3.o ost.o \
			subhaloden.mod6.o nrutil.o b2l.o spline.mod2.o \
			nnost.o  utils.o mkRtidal.o tsc_omp2.o gsmooth.o \
			Treewalk.near.o

PROGS =  gfind.exe

AR = ar  rcv
RANLIB = ranlib

#--------------------------------------------------
# Compiler settings (configured by ../configure)
#--------------------------------------------------
FFTW = @FFTW_PATH@

FC = @GALFINDER_FC@
CC = @GALFINDER_CC@

INCLUDES = -I$(FFTW)/include

DFLAGS = -DNMEG=@GALFINDER_NMEG@L

OPT = @OPT@  @OPENMP@ -DINDEX -DVarPM   -DXYZDBL -DNENER=@NENER@ -DNPRE=@NPRE@ -DREAD_SINK -DNCHEM=@GALFINDER_NCHEM@ -DADV

FFLAGS = $(FDFLAGS) $(OPT)  -mcmodel=medium
CFLAGS = $(DFLAGS)  $(OPT) $(INCLUDES)  -DDEBUG=1 -DLOG=1

LIBS = -L$(FFTW)/lib @GALFINDER_FFTW_LIBS@ -lm

#--- Suffix-based compilation rules
.SUFFIXES: .exe .o .c .f .F

#rules to build binary from source
.c.o :
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

.f.o :
	$(FC) $(FFLAGS) $(INCLUDES) -c $<

.for.o :
	$(FC) $(FFLAGS) $(INCLUDES) -c $<

.F.o :
	$(FC) $(FFLAGS) $(INCLUDES) -c $<

.c.exe :
	$(CC) $(OPT) $(INCLUDES) -o $*.exe $(OBJS) $(MPI_LINKS) $(LIBS)

.f.exe :
	$(FC) $(OPT) $(INCLUDES) -o $*.exe $(OBJS) $(MPI_LINKS) $(LIBS)

.for.exe :
	$(FC) $(OPT) $(INCLUDES) -o $*.exe $(OBJS) $(MPI_LINKS) $(LIBS)

.F.exe :
	$(FC) $(OPT) $(INCLUDES) -o $*.exe $(OBJS) $(MPI_LINKS) $(LIBS)

#--- Targets
all:
	\rm -f $(PROGS)
	$(MAKE) $(PROGS)
new: clean
	$(MAKE) all
clean:
	rm -f $(OBJS)
	rm -f $(PROGS)
$(PROGS): $(OBJS)
